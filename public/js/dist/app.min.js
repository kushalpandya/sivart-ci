!function(){function a(a,c,f,g){c.get("/api/changelists").success(function(b){a.changelistItems=b,a.changelistItems.findChangelist=function(b,c){var d,e;for(e=0;e<a.changelistItems.length;e++)if(a.changelistItems[e][b]===c){d=a.changelistItems[e];break}return d}}).error(function(a){console.log("Error Loading Changelists")}),a.onChangelistReady=function(b){g(function(){a.initSocket()},1)},a.onShowMenu=function(){$("#wrapper").toggleClass("toggled")},a.onChangelistItemClick=function(a){var b=$("#"+a),c=$("#"+a+"-details").find(".changelist-details");(b.hasClass("item-pass")||b.hasClass("item-fail"))&&(c.is(":visible")?(b.removeClass("expanded"),b.find(".changelist-status").removeAttr("rowspan"),c.slideUp("fast")):(b.addClass("expanded"),b.find(".changelist-status").attr("rowspan",2),c.slideDown("fast"),c.find(".css-pie").each(function(a){var b=$(this).text();$(this)[0].style.animationDelay="-"+parseFloat(b)+"s"})))},a.getTimeStarted=function(a){var b,c=new Date(a);return b=c.getMonth()+"/"+c.getDate()+"/"+c.getUTCFullYear()+' <span class="glyphicon glyphicon-time"></span>'+this.formatTime(c),f.trustAsHtml(b)},a.getStatus=function(a){var b={"-1":"Failed",0:"Pending",1:"Passed",2:"Running"};switch(a){case-1:b='<span class="short-message"><span class="glyphicon glyphicon-remove-circle"></span>Failed</span><span class="long-message"><span class="glyphicon glyphicon-remove-circle"></span>Build Failure</span>';break;case 0:b='<span class="glyphicon glyphicon-option-horizontal"></span>Pending';break;case 1:b='<span class="short-message"><span class="glyphicon glyphicon-ok-circle"></span>Passed</span><span class="long-message"><span class="glyphicon glyphicon-ok-circle"></span>Build Passed</span>';break;default:b='<span class="glyphicon glyphicon-refresh"></span>Running'}return f.trustAsHtml(b)},a.getBuildStatus=function(a,b){var c,d=new Date(b),e=1===a?'<span class="glyphicon glyphicon-ok-sign"></span>':'<span class="glyphicon glyphicon-remove-sign"></span>';return c='<span class="status-message">Build '+e+'</span><span class="status-time"><span class="glyphicon glyphicon-time"></span>'+this.formatTime(d)+"</span>",f.trustAsHtml(c)},a.getBuildDirectories=function(a){var b,c='<span class="directory-build"><span class="glyphicon glyphicon-folder-close"></span><a href="#">debug</a></span>';return b=a>0?'<span class="directory-release"><span class="glyphicon glyphicon-folder-close"></span><a href="#">release</a></span>':'<span class="directory-release"><span class="glyphicon glyphicon-folder-open"></span><a href="#">release</a><a href="#"><span class="glyphicon glyphicon-save"></span>get logs</a></span>',f.trustAsHtml(c+b)},a.getTestBuildStatus=function(a,b,c){var d,e="ut"===c?"Unit Test":"Functional Test",g="ut"===c?2:3,h="",i="",j="";return a.status>0?a.phase>g-1&&(d=Math.round(b.passCount/b.total*100)+"%",h='<span class="test-meta"><span class="test-status">'+e+'<span class="glyphicon glyphicon-ok-sign"></span></span><span class="test-score">'+d+"</span></span>",i='<div class="css-pie">'+d+"</div>",j='<ul class="chart-legend"><li class="total-tests">'+b.total+'</li><li class="failed-tests">'+(b.total-b.passCount)+'</li><li class="test-duration glyphicon glyphicon-time">'+this.getDuration(b.duration)+"</li></ul>"):h='<span class="test-meta"><span class="test-status">'+e+'<span class="glyphicon glyphicon glyphicon-remove-sign"></span></span><span class="test-score">0%</span><span class="test-reason">Status: <span class="cause-message">Can\'t Run</span></span></span>',f.trustAsHtml(h+i+j)},a.getInitialStatusClass=function(a){var b={"-1":"item-fail",0:"item-pending",1:"item-pass",2:"item-active"};return b[a]},a.formatTime=function(a){var b=a.getHours(),c=a.getMinutes(),d=b>=12?"pm":"am";return b+":"+c+" "+d},a.getDuration=function(a){var b=Math.round(a/1e3%60),c=Math.round(a/6e4%60),d=Math.round(a/36e5%24);return d+":"+c+":"+b},a.initSocket=function(){var c;for(b=io.connect(d.protocol+"//"+d.hostname+":"+e),c=1;c<=a.changelistItems.length;c++)g(function(a){b.emit("triggerbuild",a)},1e3*c,!0,a.changelistItems[c-1]._id);b.on("buildstart",function(b,c){var d,e=$("tr#"+b),f=e.find(".stepbar-progress");console.log("Build started for Changelist ",a.changelistItems.findChangelist("_id",b).changeListName),d=a.changelistItems.findChangelist("_id",b),d.timeStarted=c,d.activity.status=2,a.$apply(),f.attr("data-current-step",1),f.attr("data-step-status","active")}),b.on("buildfinished",function(b,c,d){var e,f=$("tr#"+b),g=f.find(".stepbar-progress");console.log("Build finished for Changelist ",a.changelistItems.findChangelist("_id",b).changeListName," with status ",c),e=a.changelistItems.findChangelist("_id",b),e.activity.phase=1,e.build.timeCompleted=d,1===c?(g.attr("data-current-step",1),g.attr("data-step-status","pass")):(e.activity.status=c,a.$apply(),g.attr("data-current-step",1),g.attr("data-step-status","fail"))}),b.on("unitteststart",function(b){var c=$("tr#"+b),d=c.find(".stepbar-progress");console.log("Unit Tests started for Changelist ",a.changelistItems.findChangelist("_id",b).changeListName),d.attr("data-current-step",2),d.attr("data-step-status","active")}),b.on("unittestfinished",function(b,c,d,e){var f,g=$("tr#"+b),h=g.find(".stepbar-progress");f=a.changelistItems.findChangelist("_id",b),f.activity.phase=2,f.unitTest.duration=d-f.timeStarted,f.unitTest.passCount=e,f.build.timeCompleted=d,1===c?(h.attr("data-current-step",2),h.attr("data-step-status","pass")):(f.activity.status=c,a.$apply(),h.attr("data-current-step",2),h.attr("data-step-status","fail"))}),b.on("functionalteststart",function(a){var b=$("tr#"+a),c=b.find(".stepbar-progress");c.attr("data-current-step",3),c.attr("data-step-status","active")}),b.on("functionaltestfinished",function(b,c,d,e){var f,g=$("tr#"+b),h=g.find(".stepbar-progress");f=a.changelistItems.findChangelist("_id",b),f.activity.status=c,a.$apply(),f.activity.phase=3,f.functionalTest.duration=d-f.timeStarted,f.functionalTest.passCount=e,f.build.timeCompleted=d,1===c?(h.attr("data-current-step",3),h.attr("data-step-status","pass")):(h.attr("data-current-step",3),h.attr("data-step-status","fail"))})}}var b,c=angular.module("sivartCI",[]),d=window.location,e=3e3;c.controller("MainController",["$scope","$http","$sce","$timeout",a]),c.directive("onFinishRender",["$timeout","$parse",function(a,b){return{restrict:"A",link:function(a,b,c){a.$last&&a.$eval(c.onFinishRender)}}}]),a.$inject=["$scope"]}();